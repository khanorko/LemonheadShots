# Banana Headshot Generator - Tech Stack & Project Rules

## üçå Project Overview
AI-powered headshot generator using Google Gemini API to create professional headshots from uploaded images.

# Project Rules for LemonheadShots

## CRITICAL: Never Change Working Features
- NEVER modify working functionality without explicit user instruction
- ONLY fix bugs that are specifically reported
- ALWAYS ask before changing behavior, even if it seems like an improvement
- WAIT for confirmation before deploying changes

## Development Process
- Focus only on what the user explicitly asks for
- Keep changes minimal and focused
- Test changes locally before suggesting deployment
- Never assume what the user wants
- **Git Workflow**: After making local commits, always push to GitHub to keep remote repository in sync

## Current Working Features (DO NOT CHANGE)
- Style selection: Single selection mode (radio button behavior)
- Upload previews: Polaroid-style frames with plus button
- Generate button hover: Shows prompt preview
- File handling: Current upload system works

## Only Fix What's Broken
- If user reports a bug, fix ONLY that bug
- If user asks for a feature, implement ONLY that feature
- Never "improve" things that aren't broken

## üõ†Ô∏è Tech Stack

### Backend
- **Node.js** - JavaScript runtime environment
- **Express.js** - Web application framework
- **Google Gemini API** - AI image generation service (`gemini-2.0-flash`)
- **Multer** - File upload middleware for handling image uploads
- **CORS** - Cross-origin resource sharing middleware
- **dotenv** - Environment variable management
- **ES Modules** - Modern JavaScript module system (`import/export`)

### Frontend
- **Vanilla JavaScript** - No framework, pure JS
- **HTML5** - Semantic markup
- **CSS3** - Modern styling with:
  - CSS Grid and Flexbox for layouts
  - CSS Custom Properties (variables)
  - CSS Transitions and animations
  - Responsive design

### File Handling
- **Server-Sent Events (SSE)** - Real-time communication for generation progress
- **Base64 encoding** - Image data processing
- **File system operations** - Saving generated images to `/uploads` directory

### Development Tools
- **Git** - Version control
- **npm** - Package management
- **Local development server** - Running on `http://localhost:3000`

## üìÅ Project Structure
```
BananaHeadshotGen/
‚îú‚îÄ‚îÄ app.js              # Frontend JavaScript
‚îú‚îÄ‚îÄ index.html          # Main HTML file
‚îú‚îÄ‚îÄ styles.css          # CSS styling
‚îú‚îÄ‚îÄ server.js           # Backend Express server
‚îú‚îÄ‚îÄ package.json        # Dependencies
‚îú‚îÄ‚îÄ .env                # Environment variables (GEMINI_API_KEY)
‚îú‚îÄ‚îÄ uploads/            # Generated images storage
‚îî‚îÄ‚îÄ README.md           # Project documentation
```

## üé® Key Features
- **Real-time progress tracking** via SSE
- **File upload handling** with drag & drop
- **Server-side cost calculation** for API usage
- **Multi-currency support** (USD/SEK)
- **Polaroid-style UI** with CSS animations
- **Results accumulation** (no replacement on new generations)
- **Conditional UI elements** (buttons show/hide based on state)

## üîß Development Guidelines

### Code Style
- Use ES6+ features (arrow functions, const/let, template literals)
- Prefer `const` over `let` when possible
- Use meaningful variable names
- Add comments for complex logic

### CSS Architecture
- Use CSS custom properties for theming
- Follow BEM-like naming for complex components
- Use flexbox/grid for layouts
- Implement responsive design patterns

### API Integration
- All Gemini API calls go through server-side endpoints
- Cost calculations are server-side to prevent tampering
- Use SSE for real-time updates
- Handle errors gracefully with try-catch blocks

### File Organization
- Keep frontend logic in `app.js`
- Server logic in `server.js`
- Styles in `styles.css`
- Generated images in `uploads/` directory

## üöÄ Deployment Notes
- Requires `GEMINI_API_KEY` environment variable
- Server runs on port 3000 by default
- Static files served from root directory
- File uploads stored in `uploads/` directory

## üêõ Common Issues & Solutions
- **Large base64 images**: Use file storage instead of SSE streaming
- **ES Module issues**: Use `process.cwd()` instead of `__dirname`
- **CORS errors**: Ensure CORS middleware is properly configured
- **Image overflow**: Use `object-fit: cover` and fixed dimensions

## üéØ Elaborate Prompt Structure (CRITICAL - DO NOT SIMPLIFY)
The AI prompt system uses a comprehensive, detailed structure that MUST be preserved:

### Year-Based Camera Gear System
- **2020+**: Canon EOS R5, 85mm f/1.4L, ISO 100, f/2.8, 1/125s, soft LED panel
- **2010+**: Canon 5D Mark II, 85mm f/1.8, ISO 200, f/2.8, 1/125s, studio strobe
- **2000+**: Canon EOS-1D, 85mm f/1.8, ISO 400, f/3.5, 1/60s, hot shoe flash
- **1990+**: Canon EOS 1, 85mm f/1.8, ISO 400, f/4, 1/60s, studio tungsten
- **1980+**: Canon AE-1, 85mm f/2, ISO 200, f/4, 1/30s, natural window light
- **1970+**: Canon FTb, 85mm f/2.8, ISO 100, f/5.6, 1/15s, incandescent bulb
- **1960+**: Canon P, 85mm f/3.5, ISO 50, f/5.6, 1/8s, natural daylight
- **1950+**: Canon VT, 85mm f/4, ISO 25, f/8, 1/4s, available light

### Fashion & Hair Instructions
"Let the year guide wardrobe and hair: era-accurate silhouettes, fabrics and accessories with natural fit and drape, and period-consistent hair finish rendered with real strand detail, subtle flyaways and believable hairline texture."

### Photographic Realism Details
"Keep it photographic and tactile: visible skin micro-texture and pores, soft subsurface scattering, tiny asymmetries, authentic film grain and halation, gentle lens vignette, slight chromatic aberration and depth falloff."

### Complete Prompt Structure
The full prompt includes: style description + year-based camera gear + fashion/hair instructions + photographic realism + lighting specifications + era-appropriate aesthetics. NEVER simplify this structure.

## üìù Recent Changes
- Added server-side cost estimation
- Implemented results accumulation
- Fixed image sizing in polaroid frames
- Added SEK currency conversion
- Improved UI collation and styling
- RESTORED elaborate prompt structure from commit bff32d1
- Created centralized prompt system with `prompt-config.json` for consistent frontend/backend prompts
- Added PERIOD STYLING section with detailed year-based fashion and hair instructions
- Implemented multi-angle identity enhancement: dynamic prompt selection based on image count (3+ uses synthesis approach)
